<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Money Pro - Complete</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #FDFBF0; --primary: #5F7444; --accent: #E9967A; --text: #4A4A4A; }
        body { font-family: 'Prompt', sans-serif; background-color: var(--bg); color: var(--text); -webkit-tap-highlight-color: transparent; transition: all 0.3s ease; }
        .card { background: white; border-radius: 24px; border: 1px solid rgba(0,0,0,0.05); }
        .tab-active { color: var(--primary); border-bottom: 3px solid var(--primary); }
        .shortcut-btn { padding: 8px 14px; border-radius: 12px; font-size: 11px; font-weight: 600; background: white; border: 1px solid rgba(0,0,0,0.1); white-space: nowrap; }
        .shortcut-btn:active { transform: scale(0.9); background: var(--primary); color: white; }
        .progress-bar { height: 12px; border-radius: 20px; background: rgba(0,0,0,0.05); overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.6s ease, background-color 0.4s; }
        .theme-dot { width: 35px; height: 35px; border-radius: 50%; border: 3px solid white; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-20">

    <div id="setModal" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-center justify-center p-6 backdrop-blur-md">
        <div class="card w-full max-w-xs p-8 space-y-6 shadow-2xl">
            <h3 class="font-bold text-center">Settings / ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
            
            <div class="space-y-2">
                <label class="text-[10px] font-bold opacity-40">CHOOSE THEME / ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏µ‡∏°</label>
                <div class="grid grid-cols-3 gap-3 justify-items-center">
                    <div onclick="setTheme('lemon')" class="theme-dot" style="background: #A1C298;"></div>
                    <div onclick="setTheme('sakura')" class="theme-dot" style="background: #F8BBD0;"></div>
                    <div onclick="setTheme('sea')" class="theme-dot" style="background: #B9EDDD;"></div>
                    <div onclick="setTheme('ocean')" class="theme-dot" style="background: #297376;"></div>
                    <div onclick="setTheme('classic')" class="theme-dot" style="background: #5F7444;"></div>
                    <div onclick="setTheme('midnight')" class="theme-dot" style="background: #013137;"></div>
                </div>
            </div>

            <div class="space-y-4 pt-2">
                <div>
                    <label class="text-[10px] font-bold opacity-40">‡∏á‡∏ö‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (Budget)</label>
                    <input type="number" id="confB" class="w-full p-3 bg-black/5 rounded-xl outline-none font-bold text-sm">
                </div>
                <div>
                    <label class="text-[10px] font-bold opacity-40">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö (Goal)</label>
                    <input type="number" id="confG" class="w-full p-3 bg-black/5 rounded-xl outline-none font-bold text-sm">
                </div>
            </div>
            <button onclick="saveConf()" class="w-full py-4 bg-stone-800 text-white rounded-2xl font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <nav class="flex justify-around bg-white/80 backdrop-blur-md sticky top-0 z-50 pt-10 border-b">
        <button onclick="showP('w')" id="tW" class="py-4 px-10 font-bold tab-active">Wallet</button>
        <button onclick="showP('p')" id="tP" class="py-4 px-10 font-bold text-stone-400">Portfolio</button>
    </nav>

    <div id="pW" class="p-5 space-y-5">
        <div class="flex justify-between items-center">
            <button onclick="toggleL()" id="lBtn" class="w-10 h-10 bg-white rounded-full shadow-sm font-bold text-[10px]">EN</button>
            <h1 id="uN" contenteditable="true" onblur="sU()" class="text-lg font-bold outline-none">My Wallet</h1>
            <button onclick="document.getElementById('setModal').classList.remove('hidden')" class="w-10 h-10 bg-white rounded-full shadow-sm text-lg">‚öôÔ∏è</button>
        </div>

        <div class="card p-8 text-center shadow-sm relative overflow-hidden">
            <div id="themeDeco" class="absolute -right-4 -top-4 w-20 h-20 rounded-full opacity-10" style="background: var(--primary)"></div>
            <p class="text-[11px] opacity-40 font-bold" data-k="totalB">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°</p>
            <h2 id="total" class="text-4xl font-black tracking-tight">‡∏ø0</h2>
            <div class="mt-6">
                <div class="flex justify-between text-[10px] mb-2 font-bold">
                    <span class="opacity-40" data-k="spend">‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span>
                    <span id="bP">0%</span>
                </div>
                <div class="progress-bar"><div id="bF" class="progress-fill" style="width: 0%"></div></div>
            </div>
        </div>

        <div id="sList" class="flex gap-2 overflow-x-auto no-scrollbar py-1"></div>

        <div class="card p-6 space-y-4 shadow-lg border-t-4" id="inputBox" style="border-top-color: var(--primary)">
            <div class="flex gap-2 p-1 bg-black/5 rounded-2xl">
                <button onclick="setT('income')" id="bI" class="flex-1 py-3 rounded-xl text-xs font-bold transition-all">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</button>
                <button onclick="setT('expense')" id="bE" class="flex-1 py-3 rounded-xl text-xs font-bold transition-all">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</button>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <input type="date" id="rD" class="p-3 bg-black/5 rounded-xl text-[11px] outline-none">
                <input type="number" id="amt" placeholder="0.00" class="p-3 bg-black/5 rounded-xl font-bold outline-none">
            </div>
            <input type="text" id="nt" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." class="w-full p-4 bg-black/5 rounded-xl text-sm outline-none">
            <button onclick="addD()" id="sv" class="w-full py-4 text-white rounded-2xl font-bold shadow-lg" style="background: var(--primary)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>

        <div id="hList" class="space-y-3"></div>
    </div>

    <div id="pP" class="p-5 hidden space-y-5">
        <div class="card p-8 bg-stone-900 text-white shadow-xl text-center">
            <p class="text-[10px] opacity-50 font-bold uppercase tracking-widest">Total Net Worth</p>
            <h3 id="nW" class="text-4xl font-bold">‡∏ø0</h3>
            
            <div class="mt-8 pt-6 border-t border-white/10">
                <div class="flex justify-between text-[10px] mb-2 font-bold">
                    <span class="opacity-50">GOAL PROGRESS</span>
                    <span id="gP">0%</span>
                </div>
                <div class="progress-bar bg-white/10"><div id="gF" class="progress-fill bg-emerald-400" style="width: 0%"></div></div>
                <p id="gS" class="text-[9px] mt-3 opacity-40 font-medium"></p>
            </div>
        </div>

        <div class="card p-5 h-64"><canvas id="pC"></canvas></div>

        <div class="space-y-3">
            <div class="card p-4 flex justify-between items-center border-l-[6px] border-[#10B981]"><span class="text-xs font-bold">üü¢ Dime</span><input type="number" onchange="upP('dime',this.value)" id="v-dime" class="text-right font-bold w-1/2 outline-none"></div>
            <div class="card p-4 flex justify-between items-center border-l-[6px] border-[#2563EB]"><span class="text-xs font-bold">üîµ Webull</span><input type="number" onchange="upP('webull',this.value)" id="v-webull" class="text-right font-bold w-1/2 outline-none"></div>
            <div class="card p-4 flex justify-between items-center border-l-[6px] border-[#38BDF8]"><span class="text-xs font-bold">üíé P. Fund</span><input type="number" onchange="upP('pvd',this.value)" id="v-pvd" class="text-right font-bold w-1/2 outline-none"></div>
            <div class="card p-4 flex justify-between items-center border-l-[6px] border-[#FBBF24]"><span class="text-xs font-bold">üü° Cash</span><input type="number" onchange="upP('cash',this.value)" id="v-cash" class="text-right font-bold w-1/2 outline-none"></div>
        </div>
        
        <button onclick="snap()" class="w-full py-5 bg-stone-800 text-white rounded-2xl font-bold">üì∏ Snap Portfolio</button>
        <div id="phList" class="space-y-3 pb-10"></div>
    </div>

    <script>
        const themes = {
            classic: { bg: '#FDFBF0', text: '#4A4A4A', primary: '#5F7444', accent: '#E9967A' },
            lemon: { bg: '#F7FFE5', text: '#4A5D23', primary: '#A1C298', accent: '#C4D7B2' },
            sakura: { bg: '#FFF0F5', text: '#5D4037', primary: '#F8BBD0', accent: '#F48FB1' },
            sea: { bg: '#E3F4F4', text: '#2C3333', primary: '#B9EDDD', accent: '#87CBB9' },
            ocean: { bg: '#D1D9DE', text: '#1A3C40', primary: '#297376', accent: '#5C9396' },
            midnight: { bg: '#011A1D', text: '#C1D9DE', primary: '#5C9396', accent: '#013137' }
        };

        const lang = {
            th: { totalB: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°', spend: '‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ', income: '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö', expense: '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢', note: '‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î...', save: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å' },
            en: { totalB: 'Total Balance', spend: 'Spending', income: 'Income', expense: 'Expense', note: 'Note...', save: 'Save' }
        };

        let recs = JSON.parse(localStorage.getItem('atp_recs')) || [];
        let port = JSON.parse(localStorage.getItem('atp_port')) || {dime:0, webull:0, pvd:0, cash:0};
        let phist = JSON.parse(localStorage.getItem('atp_hist')) || [];
        let shorts = JSON.parse(localStorage.getItem('atp_shorts')) || { income: [], expense: [] };
        let conf = JSON.parse(localStorage.getItem('atp_conf')) || { budget: 20000, goal: 1000000, theme: 'classic' };
        let curL = localStorage.getItem('atp_lang') || 'th';
        let curT = 'expense';
        let myChart;

        function setTheme(t) {
            conf.theme = t;
            const th = themes[t];
            document.documentElement.style.setProperty('--bg', th.bg);
            document.documentElement.style.setProperty('--primary', th.primary);
            document.documentElement.style.setProperty('--accent', th.accent);
            document.documentElement.style.setProperty('--text', th.text);
            document.body.style.backgroundColor = th.bg;
            document.body.style.color = th.text;
            document.getElementById('sv').style.background = th.primary;
            setT(curT); // Update input box color
        }

        function saveConf() {
            conf.budget = parseFloat(document.getElementById('confB').value) || 20000;
            conf.goal = parseFloat(document.getElementById('confG').value) || 1000000;
            localStorage.setItem('atp_conf', JSON.stringify(conf));
            document.getElementById('setModal').classList.add('hidden');
            renderW(); renderP();
        }

        function toggleL() {
            curL = curL === 'th' ? 'en' : 'th';
            localStorage.setItem('atp_lang', curL);
            updateUI();
        }

        function updateUI() {
            document.querySelectorAll('[data-k]').forEach(el => el.innerText = lang[curL][el.getAttribute('data-k')]);
            document.getElementById('lBtn').innerText = curL === 'th' ? 'EN' : 'TH';
            document.getElementById('sv').innerText = lang[curL].save;
            document.getElementById('nt').placeholder = lang[curL].note;
            renderW();
        }

        function setT(t) {
            curT = t;
            const th = themes[conf.theme];
            document.getElementById('bI').style.background = t === 'income' ? th.primary : 'transparent';
            document.getElementById('bI').style.color = t === 'income' ? '#fff' : '#9ca3af';
            document.getElementById('bE').style.background = t === 'expense' ? th.accent : 'transparent';
            document.getElementById('bE').style.color = t === 'expense' ? '#fff' : '#9ca3af';
            document.getElementById('inputBox').style.borderTopColor = t === 'income' ? th.primary : th.accent;
            renderShorts();
        }

        function renderShorts() {
            const area = document.getElementById('sList');
            area.innerHTML = shorts[curT].map(s => `<button onclick="document.getElementById('nt').value='${s}'" class="shortcut-btn">${s}</button>`).join('');
        }

        function addD() {
            const a = parseFloat(document.getElementById('amt').value);
            const n = document.getElementById('nt').value.trim();
            if(!a || !n) return;

            if(!shorts[curT].includes(n)) {
                shorts[curT].unshift(n);
                if(shorts[curT].length > 6) shorts[curT].pop();
                localStorage.setItem('atp_shorts', JSON.stringify(shorts));
            }

            recs.unshift({ type: curT, amount: a, note: n, date: document.getElementById('rD').value || new Date().toISOString().split('T')[0] });
            localStorage.setItem('atp_recs', JSON.stringify(recs));
            document.getElementById('amt').value = ''; document.getElementById('nt').value = '';
            renderW();
        }

        function renderW() {
            let total = 0, monthlyExp = 0, thisM = new Date().getMonth();
            const list = document.getElementById('hList'); list.innerHTML = '';
            
            recs.forEach((r, i) => {
                total += (r.type === 'income' ? r.amount : -r.amount);
                if(r.type === 'expense' && new Date(r.date).getMonth() === thisM) monthlyExp += r.amount;
                list.innerHTML += `<div class="card p-5 flex justify-between items-center shadow-sm border-r-4 ${r.type==='income'?'border-emerald-400':'border-rose-400'} mb-3"><div class="flex flex-col"><span class="text-xs font-bold">${r.note}</span><span class="text-[9px] opacity-30 mt-1">${r.date}</span></div><div class="flex items-center gap-4"><span class="font-bold text-sm ${r.type==='income'?'text-emerald-500':'text-rose-500'}">${r.type==='income'?'+':'-'}${r.amount.toLocaleString()}</span><button onclick="delR(${i})" class="text-stone-200">‚úï</button></div></div>`;
            });

            document.getElementById('total').innerText = '‡∏ø' + total.toLocaleString();
            
            // Budget Color Logic
            const pct = (monthlyExp / conf.budget) * 100;
            const fill = document.getElementById('bF');
            document.getElementById('bP').innerText = pct.toFixed(0) + '%';
            fill.style.width = Math.min(pct, 100) + '%';
            
            if(pct <= 60) fill.style.backgroundColor = '#10B981';
            else if(pct <= 75) fill.style.backgroundColor = '#FBBF24';
            else if(pct <= 90) fill.style.backgroundColor = '#F97316';
            else fill.style.backgroundColor = '#EF4444';

            renderShortcuts();
        }

        function renderP() {
            const net = Object.values(port).reduce((a, b) => a + b, 0);
            document.getElementById('nW').innerText = '‡∏ø' + net.toLocaleString();
            const gPct = (net / conf.goal) * 100;
            document.getElementById('gP').innerText = gPct.toFixed(1) + '%';
            document.getElementById('gF').style.width = Math.min(gPct, 100) + '%';
            document.getElementById('gS').innerText = `‡∏≠‡∏µ‡∏Å ‡∏ø${Math.max(conf.goal - net, 0).toLocaleString()} ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢`;
            document.getElementById('phList').innerHTML = phist.map((h, i) => `<div class="card p-4 flex justify-between items-center text-xs mb-2"><span>${h.date}</span><div class="flex items-center gap-4"><b>‡∏ø${h.total.toLocaleString()}</b><button onclick="phist.splice(${i},1);localStorage.setItem('atp_hist',JSON.stringify(phist));renderP()" class="text-stone-200">‚úï</button></div></div>`).join('');
            ['dime','webull','pvd','cash'].forEach(k => document.getElementById('v-'+k).value = port[k] || '');
        }

        function renderPC() {
            const ctx = document.getElementById('pC').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Dime', 'Webull', 'P.Fund', 'Cash'], datasets: [{ data: Object.values(port).map(v=>v||0.001), backgroundColor: ['#10B981', '#2563EB', '#38BDF8', '#FBBF24'], borderWidth: 0 }] }, options: { cutout: '75%', maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10, family: 'Prompt' } } } } } });
        }

        function showP(p) {
            document.getElementById('pW').classList.toggle('hidden', p !== 'w');
            document.getElementById('pP').classList.toggle('hidden', p !== 'p');
            document.getElementById('tW').className = `py-4 px-10 font-bold ${p === 'w' ? 'tab-active' : 'text-stone-400'}`;
            document.getElementById('tP').className = `py-4 px-10 font-bold ${p === 'p' ? 'tab-active' : 'text-stone-400'}`;
            if(p === 'p') { renderP(); renderPC(); }
        }

        function delR(i) { if(confirm('Delete?')) { recs.splice(i, 1); localStorage.setItem('atp_recs', JSON.stringify(recs)); renderW(); } }
        function upP(k, v) { port[k] = parseFloat(v) || 0; localStorage.setItem('atp_port', JSON.stringify(port)); renderP(); renderPC(); }
        function snap() { phist.unshift({ date: new Date().toLocaleDateString(), total: Object.values(port).reduce((a, b) => a + b, 0) }); localStorage.setItem('atp_hist', JSON.stringify(phist)); renderP(); }
        function sU() { localStorage.setItem('atp_usr', document.getElementById('uN').innerText); }

        // Boot
        document.getElementById('rD').valueAsDate = new Date();
        document.getElementById('confB').value = conf.budget;
        document.getElementById('confG').value = conf.goal;
        document.getElementById('uN').innerText = localStorage.getItem('atp_usr') || 'My Wallet';
        setTheme(conf.theme);
        updateUI();
    </script>
</body>
</html>
