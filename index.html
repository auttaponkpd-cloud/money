<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Money Manage Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #FDFBF0; --card: #FFFFFF; --text: #4A4A4A; --primary: #5F7444; --accent: #E9967A; }
        body { font-family: 'Prompt', sans-serif; background-color: var(--bg); color: var(--text); transition: all 0.4s ease; -webkit-tap-highlight-color: transparent; min-height: 100vh; }
        .card { background: var(--card); border-radius: 24px; border: 1px solid rgba(0,0,0,0.05); transition: all 0.3s ease; }
        .tab-active { color: var(--primary); border-bottom: 3px solid var(--primary); }
        .shortcut-btn { padding: 8px 14px; border-radius: 12px; font-size: 11px; font-weight: 600; background: white; border: 1px solid rgba(0,0,0,0.08); white-space: nowrap; transition: all 0.2s; }
        .shortcut-btn:active { transform: scale(0.9); background: var(--primary); color: white; }
        .progress-bar { height: 10px; border-radius: 10px; background: rgba(0,0,0,0.05); overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.8s ease, background-color 0.5s ease; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-24">

    <div id="themeModal" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-center justify-center p-6 backdrop-blur-md">
        <div class="card w-full max-w-xs p-8 space-y-6 text-center shadow-2xl">
            <h3 class="font-semibold text-lg" data-key="config">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
            <div class="space-y-4">
                <div class="text-left">
                    <label class="text-[10px] font-bold opacity-40" data-key="setBudget">‡∏á‡∏ö‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="configBudget" onchange="saveConfig()" class="w-full p-2 bg-black/5 rounded-lg outline-none font-bold">
                </div>
                <div class="text-left">
                    <label class="text-[10px] font-bold opacity-40" data-key="setGoal">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="configGoal" onchange="saveConfig()" class="w-full p-2 bg-black/5 rounded-lg outline-none font-bold">
                </div>
            </div>
            <button onclick="toggleThemeModal(false)" class="w-full py-3 bg-stone-800 text-white rounded-xl font-bold" data-key="close">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <nav class="flex justify-around bg-white/70 backdrop-blur-xl sticky top-0 z-50 border-b border-stone-100 pt-10">
        <button onclick="showPage('wallet')" id="tabWallet" class="py-4 px-10 font-semibold tab-active">Wallet</button>
        <button onclick="showPage('portfolio')" id="tabPortfolio" class="py-4 px-10 font-semibold text-stone-400">Portfolio</button>
    </nav>

    <div id="pageWallet" class="p-5 space-y-5">
        <div class="flex justify-between items-center">
            <button onclick="toggleLang()" class="w-10 h-10 bg-white rounded-full shadow-sm font-bold text-[10px]" id="langBtn">EN</button>
            <h1 id="userName" contenteditable="true" onblur="saveUser()" class="text-lg font-semibold outline-none">My Wallet</h1>
            <button onclick="toggleThemeModal(true)" class="text-xl bg-white p-2 rounded-full shadow-sm">‚öôÔ∏è</button>
        </div>

        <div class="card p-8 text-center shadow-sm relative overflow-hidden">
            <p class="text-[11px] opacity-50 mb-1 font-medium" data-key="totalBalanceText">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</p>
            <h2 id="totalBalance" class="text-4xl font-bold tracking-tight">‡∏ø0</h2>
            <div class="mt-6">
                <div class="flex justify-between text-[10px] mb-2 font-bold">
                    <span class="opacity-40" data-key="monthlyBudget">‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span>
                    <span id="budgetPercent">0%</span>
                </div>
                <div class="progress-bar"><div id="budgetFill" class="progress-fill" style="width: 0%"></div></div>
            </div>
        </div>

        <div id="shortcutArea" class="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
            </div>

        <div class="card p-6 space-y-4 shadow-md border-t-4" style="border-top-color: var(--primary)">
            <div class="flex gap-3 p-1.5 bg-black/5 rounded-2xl">
                <button onclick="setType('income')" id="btnIn" class="flex-1 py-2.5 rounded-xl text-xs font-bold transition-all" data-key="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</button>
                <button onclick="setType('expense')" id="btnEx" class="flex-1 py-2.5 rounded-xl text-xs font-bold transition-all" data-key="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</button>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <input type="date" id="recordDate" class="p-3 bg-black/5 rounded-xl text-[11px] outline-none">
                <input type="number" id="amount" placeholder="0.00" class="p-3 bg-black/5 rounded-xl text-sm font-bold outline-none">
            </div>
            <input type="text" id="note" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." class="w-full p-4 bg-black/5 rounded-xl text-xs outline-none" data-key="notePlaceholder">
            <button onclick="addData()" id="btnSave" class="w-full py-4 text-white rounded-2xl font-bold text-sm shadow-lg" data-key="saveBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        </div>

        <div id="historyList" class="space-y-3 pt-2"></div>
    </div>

    <div id="pagePortfolio" class="p-5 hidden space-y-5">
        <div class="card p-8 bg-stone-900 text-white shadow-xl text-center">
            <p class="text-[10px] opacity-50 uppercase tracking-widest mb-2 font-bold" data-key="netWorthText">Total Net Worth</p>
            <h3 id="netWorth" class="text-4xl font-bold">‡∏ø0</h3>
            <div id="growthText" class="text-[11px] mt-2 font-semibold"></div>
            
            <div class="mt-6 bg-white/5 p-4 rounded-xl border border-white/10">
                <div class="flex justify-between text-[10px] mb-2 font-bold uppercase">
                    <span class="opacity-50" data-key="goalProgress">Goal Progress</span>
                    <span id="goalPercentDisplay">0%</span>
                </div>
                <div class="progress-bar bg-white/10"><div id="goalFill" class="progress-fill bg-emerald-400" style="width: 0%"></div></div>
                <p class="text-[9px] mt-2 opacity-40" id="goalStatusText"></p>
            </div>
        </div>

        <div class="card p-5 h-[250px]"><canvas id="portChart"></canvas></div>

        <div class="space-y-3">
            <div class="card p-4 flex justify-between items-center border-l-[6px] border-[#10B981]"><span class="text-xs font-bold">üü¢ Dime</span><input type="number" onchange="upPort('dime', this.value)" id="v-dime" class="text-right font-bold w-1/2 bg-transparent outline-none text-lg"></div>
            <div class="card p-4 flex justify-between items-center border-l-[6px] border-[#2563EB]"><span class="text-xs font-bold">üîµ Webull</span><input type="number" onchange="upPort('webull', this.value)" id="v-webull" class="text-right font-bold w-1/2 bg-transparent outline-none text-lg"></div>
            <div class="card p-4 flex justify-between items-center border-l-[6px] border-[#38BDF8]"><span class="text-xs font-bold">üíé P. Fund</span><input type="number" onchange="upPort('pvd', this.value)" id="v-pvd" class="text-right font-bold w-1/2 bg-transparent outline-none text-lg"></div>
            <div class="card p-4 flex justify-between items-center border-l-[6px] border-[#FBBF24]"><span class="text-xs font-bold">üü° Cash</span><input type="number" onchange="upPort('cash', this.value)" id="v-cash" class="text-right font-bold w-1/2 bg-transparent outline-none text-lg"></div>
        </div>

        <button onclick="snapPort()" class="w-full py-5 bg-stone-800 text-white rounded-2xl font-bold text-sm shadow-xl" data-key="snapBtn">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
        <div id="portHistList" class="space-y-3 pb-6"></div>
    </div>

    <script>
        const i18n = {
            th: {
                config: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô', close: '‡∏ï‡∏Å‡∏•‡∏á', setBudget: '‡∏á‡∏ö‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)', setGoal: '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö (‡∏ö‡∏≤‡∏ó)',
                totalBalanceText: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', monthlyBudget: '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ',
                income: '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö', expense: '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢', notePlaceholder: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î...',
                saveBtn: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', netWorthText: '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°', goalProgress: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢',
                snapBtn: 'üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ'
            },
            en: {
                config: 'Settings', close: 'Done', setBudget: 'Monthly Budget (‡∏ø)', setGoal: 'Financial Goal (‡∏ø)',
                totalBalanceText: 'Total Balance', monthlyBudget: 'Monthly Spending',
                income: 'Income', expense: 'Expense', notePlaceholder: 'Note...',
                saveBtn: 'Save Record', netWorthText: 'Total Net Worth', goalProgress: 'Goal Progress',
                snapBtn: 'üì∏ Snap Portfolio Today'
            }
        };

        let records = JSON.parse(localStorage.getItem('atp_recs')) || [];
        let port = JSON.parse(localStorage.getItem('atp_port')) || {dime:0, webull:0, pvd:0, cash:0};
        let pHist = JSON.parse(localStorage.getItem('atp_hist')) || [];
        let shortcuts = JSON.parse(localStorage.getItem('atp_shorts')) || { income: [], expense: [] };
        let config = JSON.parse(localStorage.getItem('atp_conf')) || { budget: 20000, goal: 1000000 };
        let cLang = localStorage.getItem('atp_lang') || 'th';
        let pChart, cType = 'expense';

        function saveConfig() {
            config.budget = parseFloat(document.getElementById('configBudget').value) || 20000;
            config.goal = parseFloat(document.getElementById('configGoal').value) || 1000000;
            localStorage.setItem('atp_conf', JSON.stringify(config));
            renderWallet(); renderPort();
        }

        function toggleLang() {
            cLang = cLang === 'th' ? 'en' : 'th';
            localStorage.setItem('atp_lang', cLang);
            updateLanguageUI();
        }

        function updateLanguageUI() {
            document.querySelectorAll('[data-key]').forEach(el => el.innerText = i18n[cLang][el.getAttribute('data-key')]);
            document.getElementById('langBtn').innerText = cLang === 'th' ? 'EN' : 'TH';
            renderWallet();
        }

        function addData() {
            const amt = parseFloat(document.getElementById('amount').value);
            const note = document.getElementById('note').value.trim();
            if(!amt || !note) return;

            // Update Dynamic Shortcuts
            let list = shortcuts[cType];
            if (!list.includes(note)) {
                list.unshift(note);
                if (list.length > 6) list.pop();
                localStorage.setItem('atp_shorts', JSON.stringify(shortcuts));
            }

            records.unshift({ type: cType, amount: amt, note: note, date: document.getElementById('recordDate').value || new Date().toISOString().split('T')[0] });
            localStorage.setItem('atp_recs', JSON.stringify(records));
            renderWallet();
            document.getElementById('amount').value = ''; document.getElementById('note').value = '';
        }

        function renderWallet() {
            let total = 0, monthlyExp = 0, thisMonth = new Date().getMonth();
            const list = document.getElementById('historyList'); list.innerHTML = '';
            
            records.forEach((r, i) => {
                total += (r.type === 'income' ? r.amount : -r.amount);
                if(r.type === 'expense' && new Date(r.date).getMonth() === thisMonth) monthlyExp += r.amount;
                list.innerHTML += `<div class="card p-5 flex justify-between items-center shadow-sm border-r-4 ${r.type==='income'?'border-emerald-400':'border-rose-400'}"><div class="flex flex-col"><span class="text-xs font-bold">${r.note}</span><span class="text-[9px] opacity-30 mt-1">${r.date}</span></div><div class="flex items-center gap-4"><span class="font-bold text-sm ${r.type==='income'?'text-emerald-500':'text-rose-500'}">${r.type==='income'?'+':'-'}${r.amount.toLocaleString()}</span><button onclick="delRec(${i})" class="text-stone-200">‚úï</button></div></div>`;
            });

            document.getElementById('totalBalance').innerText = '‡∏ø' + total.toLocaleString();
            
            // Budget Progress Color Logic
            const bPct = (monthlyExp / config.budget) * 100;
            const fill = document.getElementById('budgetFill');
            document.getElementById('budgetPercent').innerText = bPct.toFixed(0) + '%';
            fill.style.width = Math.min(bPct, 100) + '%';
            
            if (bPct <= 60) fill.style.backgroundColor = '#10B981'; // Green
            else if (bPct <= 75) fill.style.backgroundColor = '#FBBF24'; // Yellow
            else if (bPct <= 90) fill.style.backgroundColor = '#F97316'; // Orange
            else fill.style.backgroundColor = '#EF4444'; // Red

            renderShortcuts();
            setType(cType);
        }

        function renderShortcuts() {
            const area = document.getElementById('shortcutArea');
            area.innerHTML = shortcuts[cType].map(s => `<button onclick="document.getElementById('note').value='${s}'" class="shortcut-btn">${s}</button>`).join('');
        }

        function setType(t) {
            cType = t;
            document.getElementById('btnIn').style.background = t === 'income' ? '#5F7444' : 'transparent';
            document.getElementById('btnIn').style.color = t === 'income' ? '#fff' : '#9ca3af';
            document.getElementById('btnEx').style.background = t === 'expense' ? '#E9967A' : 'transparent';
            document.getElementById('btnEx').style.color = t === 'expense' ? '#fff' : '#9ca3af';
            renderShortcuts();
        }

        function renderPort() {
            const net = Object.values(port).reduce((a, b) => a + b, 0);
            document.getElementById('netWorth').innerText = '‡∏ø' + net.toLocaleString();
            
            // Goal Progress
            const gPct = (net / config.goal) * 100;
            document.getElementById('goalPercentDisplay').innerText = gPct.toFixed(1) + '%';
            document.getElementById('goalFill').style.width = Math.min(gPct, 100) + '%';
            document.getElementById('goalStatusText').innerText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ‡∏ø${Math.max(config.goal - net, 0).toLocaleString()} ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢`;

            if(pHist.length > 1) {
                const diff = (((net - pHist[1].total) / pHist[1].total) * 100).toFixed(1);
                document.getElementById('growthText').innerText = `${diff >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(diff)}% vs last`;
                document.getElementById('growthText').className = `text-[11px] mt-2 font-bold ${diff >= 0 ? 'text-emerald-400' : 'text-rose-400'}`;
            }
            document.getElementById('portHistList').innerHTML = pHist.map((h, i) => `<div class="card p-4 flex justify-between items-center text-xs"><span>${h.date}</span><div class="flex items-center gap-4"><b>‡∏ø${h.total.toLocaleString()}</b><button onclick="pHist.splice(${i},1);localStorage.setItem('atp_hist',JSON.stringify(pHist));renderPort()" class="text-stone-200">‚úï</button></div></div>`).join('');
        }

        function renderPortChart() {
            const ctx = document.getElementById('portChart').getContext('2d');
            if (pChart) pChart.destroy();
            pChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Dime', 'Webull', 'P.Fund', 'Cash'], datasets: [{ data: Object.values(port), backgroundColor: ['#10B981', '#2563EB', '#38BDF8', '#FBBF24'], borderWidth: 0 }] }, options: { cutout: '70%', maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10, family: 'Prompt' } } } } } });
        }

        function showPage(p) {
            document.getElementById('pageWallet').classList.toggle('hidden', p !== 'wallet');
            document.getElementById('pagePortfolio').classList.toggle('hidden', p !== 'portfolio');
            document.getElementById('tabWallet').className = `py-4 px-10 font-bold ${p === 'wallet' ? 'tab-active' : 'text-stone-400'}`;
            document.getElementById('tabPortfolio').className = `py-4 px-10 font-bold ${p === 'portfolio' ? 'tab-active' : 'text-stone-400'}`;
            if(p === 'portfolio') { renderPort(); renderPortChart(); }
        }

        function delRec(i) { if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) { records.splice(i, 1); localStorage.setItem('atp_recs', JSON.stringify(records)); renderWallet(); } }
        function upPort(k, v) { port[k] = parseFloat(v) || 0; localStorage.setItem('atp_port', JSON.stringify(port)); renderPortChart(); renderPort(); }
        function snapPort() { pHist.unshift({ date: new Date().toLocaleDateString(), total: Object.values(port).reduce((a, b) => a + b, 0) }); localStorage.setItem('atp_hist', JSON.stringify(pHist)); renderPort(); }
        function toggleThemeModal(s) { document.getElementById('themeModal').classList.toggle('hidden', !s); }
        function saveUser() { localStorage.setItem('atp_usr', document.getElementById('userName').innerText); }

        // Init
        document.getElementById('configBudget').value = config.budget;
        document.getElementById('configGoal').value = config.goal;
        document.getElementById('recordDate').valueAsDate = new Date();
        document.getElementById('userName').innerText = localStorage.getItem('atp_usr') || 'My Wallet';
        updateLanguageUI();
    </script>
</body>
</html>
